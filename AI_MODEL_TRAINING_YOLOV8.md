# YOLOv8 Civic Issue Detection - Training Status

## Training Session: January 23, 2026

### Overview
Training custom YOLOv8 model for civic issue classification on 6 classes with 300 total images.

---

## Dataset Information

### Classes (6 total)
1. **Pothole** - 50 images
2. **Garbage** - 50 images  
3. **Debris** - 50 images
4. **Stray Cattle** - 50 images
5. **Broken Road** - 50 images
6. **Open Manhole** - 50 images

### Dataset Split
- **Training Set**: 240 images (80%)
- **Validation Set**: 60 images (20%)
- **Total Images**: 300

### Data Format
- Image format: PNG (synthetic_000.png, synthetic_001.png, ...)
- YOLO label format: `class_id x_center y_center width height` (normalized 0-1)
- For classification: `class_id 0.5 0.5 1.0 1.0` (full image bbox)

---

## Training Configuration

### Model Details
- **Base Model**: YOLOv8n (nano - fastest, smallest)
- **Pretrained Weights**: yolov8n.pt (COCO dataset)
- **Custom Classes**: 6 civic issue types
- **Framework**: Ultralytics YOLOv8 8.4.7

### Hyperparameters
```yaml
epochs: 100
batch_size: 16
image_size: 640
device: cpu
optimizer: Adam
learning_rate: 0.01
lr_scheduler: Cosine
early_stopping_patience: 20
save_checkpoint_every: 10 epochs
```

### Training Features
- **Transfer Learning**: Fine-tuning pretrained COCO weights
- **Data Augmentation**: Built-in YOLO augmentations (rotation, scaling, flipping)
- **Validation**: Runs every epoch with mAP metrics
- **Early Stopping**: Stops if no improvement for 20 epochs
- **Best Model Saving**: Automatically saves best performing model

---

## Training Scripts Created

### 1. train_yolov8_custom.py
**Purpose**: Custom YOLOv8 training pipeline for civic issues

**Features**:
- âœ… Dataset preparation (converts training_data/ to YOLO format)
- âœ… Train/val split (80-20)
- âœ… data.yaml generation
- âœ… YOLOv8n training with custom parameters
- âœ… Validation metrics (mAP50, mAP50-95, precision, recall)
- âœ… Sample image testing
- âœ… Training summary JSON export
- âœ… Model saved to `models/yolov8_civic_custom.pt`

**How to Run**:
```bash
cd ai-service
python train_yolov8_custom.py
```

**Expected Duration**: 20-30 minutes (100 epochs on CPU)

### 2. test_yolov8_model.py
**Purpose**: Comprehensive model testing and evaluation

**Features**:
- âœ… Load custom or pretrained model
- âœ… Test on validation images
- âœ… Per-class accuracy calculation
- âœ… Confusion matrix generation
- âœ… Confidence distribution analysis
- âœ… Classification report (precision, recall, F1)
- âœ… Performance recommendations
- âœ… Visual plots (confusion matrix, confidence analysis)
- âœ… Detailed JSON results export

**How to Run**:
```bash
cd ai-service
python test_yolov8_model.py
```

**Outputs**:
- `test_results/confusion_matrix.png`
- `test_results/confidence_analysis.png`
- `test_results/test_summary.json`

---

## Training Progress

### Current Status
ğŸŸ¢ **TRAINING IN PROGRESS**

**Started**: January 23, 2026
**Current Phase**: Epoch training
**Terminal ID**: 9bfe16d1-2199-4028-bee0-616041b489fd

**Progress Log**:
```
âœ… [1/6] Dataset prepared (240 train, 60 val)
âœ… [2/6] data.yaml configuration created
âœ… [3/6] YOLOv8n model initialized
ğŸ”„ [4/6] Training in progress...
â³ [5/6] Validation pending...
â³ [6/6] Sample testing pending...
```

### Expected Outputs

#### 1. Trained Model
- **Location**: `models/yolov8_civic_custom.pt`
- **Size**: ~6MB
- **Format**: PyTorch (.pt)

#### 2. Training Artifacts
- **Dataset**: `dataset_yolo/` (train/val splits with YOLO labels)
- **Config**: `dataset_yolo/data.yaml`
- **Runs**: `runs/civic_issues/yolov8_training/` (logs, plots, checkpoints)
- **Summary**: `training_summary.json` (metrics, results)

#### 3. Training Plots (Generated by YOLO)
- `results.png` - Training/validation curves
- `confusion_matrix.png` - Prediction matrix
- `F1_curve.png` - F1 score vs confidence
- `PR_curve.png` - Precision-Recall curve
- `P_curve.png` - Precision vs confidence
- `R_curve.png` - Recall vs confidence

---

## Validation Metrics

### Key Metrics (To be calculated)
- **mAP50**: Mean Average Precision @ IoU 0.5
- **mAP50-95**: Mean Average Precision @ IoU 0.5-0.95
- **Precision**: True Positives / (True Positives + False Positives)
- **Recall**: True Positives / (True Positives + False Negatives)
- **F1-Score**: Harmonic mean of precision and recall

### Per-Class Metrics
- Accuracy for each of 6 civic issue types
- Confidence score distribution
- Common misclassifications

### Target Performance
- **Excellent**: >90% accuracy
- **Good**: 75-90% accuracy  
- **Needs Improvement**: <75% accuracy

---

## Integration with AI Service

### Current AI Service Architecture
```
ai-service/src/
â”œâ”€â”€ main.py          â†’ FastAPI application
â”œâ”€â”€ model.py         â†’ YOLOv8Handler class
â”œâ”€â”€ classifier.py    â†’ ClassificationService
â””â”€â”€ config.py        â†’ Configuration (MODEL_PATH, ISSUE_TYPE_MAPPING)
```

### Configuration Update Required

**File**: `ai-service/src/config.py`

**Current**:
```python
MODEL_PATH = './models/yolov8n.pt'  # Pretrained COCO
```

**After Training** (if performance is good):
```python
MODEL_PATH = './models/yolov8_civic_custom.pt'  # Custom trained
```

Or use environment variable:
```bash
# .env
MODEL_PATH=./models/yolov8_civic_custom.pt
```

### Testing Integration
```bash
# 1. Start AI service with custom model
cd ai-service
python src/main.py

# 2. Test classification endpoint
curl -X POST "http://localhost:8000/classify" \
  -F "file=@test_image.jpg"

# 3. Check model info
curl http://localhost:8000/model-info
```

---

## Next Steps

### 1. Monitor Training (In Progress)
```bash
# Check training progress
Get-Content .\ai-service\training_log.txt -Wait

# Or monitor terminal output
# Terminal ID: 9bfe16d1-2199-4028-bee0-616041b489fd
```

### 2. Run Comprehensive Testing (After Training)
```bash
cd ai-service
python test_yolov8_model.py
```

**Review**:
- [ ] Check `test_results/test_summary.json`
- [ ] Review `test_results/confusion_matrix.png`
- [ ] Analyze `test_results/confidence_analysis.png`
- [ ] Validate per-class accuracy

### 3. Update Configuration (If Performance Good)
```bash
# Backup current model
mv models/yolov8n.pt models/yolov8n_pretrained_backup.pt

# Update config.py or .env
# MODEL_PATH=./models/yolov8_civic_custom.pt
```

### 4. Integration Testing
- [ ] Start AI service with custom model
- [ ] Test `/classify` endpoint
- [ ] Verify classifications are accurate
- [ ] Check confidence scores are reasonable
- [ ] Test with backend API integration

### 5. Performance Benchmarking
Compare custom vs pretrained model:
- [ ] Classification accuracy
- [ ] Inference speed
- [ ] Confidence score quality
- [ ] Model size

### 6. Production Deployment
- [ ] Update Docker image with custom model
- [ ] Update deployment documentation
- [ ] Add model version info to API
- [ ] Setup model monitoring

---

## Troubleshooting

### If Training Fails
1. **Check dataset format**: Ensure images are in correct directories
2. **Verify YOLO labels**: Check `dataset_yolo/train/labels/` and `val/labels/`
3. **Review data.yaml**: Ensure paths and class names are correct
4. **Check GPU/CPU**: YOLOv8 auto-detects, CPU training is slower
5. **Memory issues**: Reduce batch size (currently 16)

### If Accuracy is Low (<75%)
1. **Collect more data**: 100+ images per class recommended
2. **Increase epochs**: Try 200-300 epochs
3. **Try larger model**: YOLOv8s or YOLOv8m
4. **Check data quality**: Ensure diverse lighting/angles
5. **Verify labels**: Ensure training data is correctly labeled

### If Model Size Too Large
- Current: YOLOv8n (~6MB) âœ…
- Use model quantization for smaller size
- Consider YOLOv8n-seg (segmentation) if needed

### If Inference Too Slow
- Current: CPU inference
- Use GPU for faster inference
- Reduce image size (640 â†’ 416)
- Use model optimization (ONNX, TensorRT)

---

## Dependencies Installed

### Core ML Libraries
```txt
torch>=2.1.0            # PyTorch deep learning
torchvision>=0.16.0     # Vision utilities
ultralytics>=8.0.217    # YOLOv8 framework
```

### Image Processing
```txt
opencv-python>=4.8.1    # Computer vision
pillow>=10.1.0          # Image manipulation
numpy>=1.26.2           # Array operations
```

### Evaluation & Visualization
```txt
matplotlib>=3.8.0       # Plotting
seaborn>=0.13.0         # Statistical plots
scikit-learn>=1.3.0     # Metrics (confusion matrix, etc.)
```

### API & Utilities
```txt
fastapi==0.104.1        # Web framework
uvicorn==0.24.0         # ASGI server
redis>=5.0.1            # Caching
python-multipart        # File uploads
pydantic>=2.0.0         # Data validation
python-dotenv==1.0.0    # Environment variables
```

---

## File Structure

```
ai-service/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ yolov8n.pt                    # Pretrained (downloading)
â”‚   â””â”€â”€ yolov8_civic_custom.pt        # Custom trained (pending)
â”œâ”€â”€ training_data/
â”‚   â”œâ”€â”€ pothole/                      # 50 images
â”‚   â”œâ”€â”€ garbage/                      # 50 images
â”‚   â”œâ”€â”€ debris/                       # 50 images
â”‚   â”œâ”€â”€ stray_cattle/                 # 50 images
â”‚   â”œâ”€â”€ broken_road/                  # 50 images
â”‚   â””â”€â”€ open_manhole/                 # 50 images
â”œâ”€â”€ dataset_yolo/                     # Generated YOLO format
â”‚   â”œâ”€â”€ data.yaml
â”‚   â”œâ”€â”€ train/
â”‚   â”‚   â”œâ”€â”€ images/                   # 240 images
â”‚   â”‚   â””â”€â”€ labels/                   # 240 .txt labels
â”‚   â””â”€â”€ val/
â”‚       â”œâ”€â”€ images/                   # 60 images
â”‚       â””â”€â”€ labels/                   # 60 .txt labels
â”œâ”€â”€ runs/
â”‚   â””â”€â”€ civic_issues/
â”‚       â””â”€â”€ yolov8_training/          # Training logs & plots
â”œâ”€â”€ test_results/                     # Testing outputs (pending)
â”‚   â”œâ”€â”€ confusion_matrix.png
â”‚   â”œâ”€â”€ confidence_analysis.png
â”‚   â””â”€â”€ test_summary.json
â”œâ”€â”€ train_yolov8_custom.py            # âœ… Training script
â”œâ”€â”€ test_yolov8_model.py              # âœ… Testing script
â”œâ”€â”€ training_summary.json             # Training results (pending)
â”œâ”€â”€ requirements.txt                  # âœ… Updated dependencies
â””â”€â”€ src/
    â”œâ”€â”€ main.py                       # FastAPI app
    â”œâ”€â”€ model.py                      # YOLOv8Handler
    â”œâ”€â”€ classifier.py                 # ClassificationService
    â””â”€â”€ config.py                     # Configuration
```

---

## Performance Expectations

### With 50 Images Per Class (Current)
- **Expected Accuracy**: 70-85%
- **Confidence**: May vary (0.3-0.9)
- **Overfitting Risk**: Low (small dataset)
- **Recommendation**: Acceptable for MVP/demo

### Ideal Dataset Size
- **Recommended**: 200-500 images per class
- **Expected Accuracy**: 90-95%
- **Confidence**: More consistent (0.6-0.95)
- **Production Ready**: Yes

### Model Size Comparison
| Model | Size | Speed | Accuracy | Best For |
|-------|------|-------|----------|----------|
| YOLOv8n | ~6MB | âš¡âš¡âš¡ Fast | Good | Mobile/Edge |
| YOLOv8s | ~22MB | âš¡âš¡ Medium | Better | Balanced |
| YOLOv8m | ~50MB | âš¡ Slower | Best | Accuracy |

**Current Choice**: YOLOv8n (optimal for 300 images, fast inference) âœ…

---

## Documentation Updated
- âœ… `requirements.txt` - Updated with flexible versions
- âœ… `train_yolov8_custom.py` - Comprehensive training script
- âœ… `test_yolov8_model.py` - Full testing suite
- âœ… `AI_MODEL_TRAINING_YOLOV8.md` - This documentation

## Training Initiated
- ğŸ”„ Training process started
- ğŸ”„ Pretrained weights downloading
- â³ Estimated completion: 20-30 minutes
- ğŸ“Š Check terminal for progress updates

---

## Contact & Support

For questions or issues during training:
1. Check terminal output for errors
2. Review `runs/civic_issues/yolov8_training/` logs
3. Verify dataset_yolo/ structure
4. Test with smaller epochs (e.g., 10) first
5. Monitor CPU/memory usage

---

**Last Updated**: January 23, 2026
**Training Status**: IN PROGRESS â³
**Next Action**: Wait for training completion, then run testing script
