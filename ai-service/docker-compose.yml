version: '3.8'

services:
  # Combined AI + Robot Service (Both services in one container)
  ai-robot-service:
    build:
      context: ./ai-service
      dockerfile: Dockerfile
    container_name: civic-issues-ai-robot
    environment:
      AI_PORT: 5000
      ROBOT_PORT: 5001
      ROBOFLOW_API_KEY: ${ROBOFLOW_API_KEY:-wDn97RYRazmoOEE8okiH}
      DEBUG: "False"
    ports:
      - "5000:5000"  # AI Service (YOLOv8)
      - "5001:5001"  # Robot Service (Roboflow)
    volumes:
      - ./ai-service/models:/app/models
      - ./ai-service/uploads:/app/uploads
      - ./ai-service/logs:/app/logs
      - ./ai-service/robot-service/static:/app/robot-service/static
    networks:
      - civic-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:5000/health && curl -f http://localhost:5001/health"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  civic-network:
    driver: bridge
